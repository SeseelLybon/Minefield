
import pyglet
from pyglet.window import key
from pyglet.window import mouse

import logging
logging.basicConfig(level=logging.DEBUG)

from chunk import Chunk
from position import Position

resources_folder = "resources/"

logging.debug("Booting...")
logging.debug("Root... %s", __file__ )

#fps_display = pyglet.clock.ClockDisplay()
window = pyglet.window.Window()

score = 0
label = pyglet.text.Label('score: '+str(score),
                        font_name='Times New Roman',
                        font_size=36,
                        x=50, y=window.height-100,
                        anchor_x='center', anchor_y='center')

chunk_dict = dict()

chunk_dict[(0,0)] = Chunk((0,0))
chunk_dict[(1,0)] = Chunk((1,0))

#print(chunk_dict[(0,0)])


@window.event
def on_draw():
    window.clear()
    #fps_display.draw()
    label.text = 'score: '+str(score)
    label.draw()
    for chunk in chunk_dict.values():
        chunk.draw((0,0))


@window.event
def on_key_press(symbol, modifiers):
    if symbol == key.UP:
        print("Hello world")


@window.event
def on_mouse_press(x, y, button, modifiers):
    global score

    tilepos = Position.pixtotile((x,y))
    chunkpos = Position.pixtochunk((x,y))

    if button == mouse.LEFT:
        print('Clicked at', x, y, chunkpos, tilepos)
        score += 1
        chunk_dict[chunkpos].gettile(tilepos).reveal()
    if button == mouse.RIGHT:
        print('Clicked at', x, y, chunkpos, tilepos)
        chunk_dict[chunkpos].gettile(tilepos).flag()


@window.event
def on_mouse_scroll(x, y, scroll_x, scroll_y):
    global score
    score += scroll_y

@window.event
def on_mouse_drag(x, y, dx, dy, buttons, modifiers):
    global score
    score += 10


logging.debug("Pyglet.run()")
pyglet.app.run()

logging.debug("End of main")
